import{b as f,r as b,a as H,_ as R,e as T}from"./Dialog.24669630.js";import{d as G,A as J,r as s,i as E,B as K,e as O,H as P,o as r,c as d,a as n,F as _,s as D,m as w,n as Q,u as W,q as Z,x as ee,I as te,t as y}from"./index.bf2b1302.js";const oe=n("h2",null,"\u4E66\u67B6",-1),le=n("div",{"btn-logo":"","i-ph:magnifying-glass":""},null,-1),ne={"mt-10":"",bg:"light-100/50","min-h":"[78.5vh]","rounded-2xl":"",font:"sans",shadow:"xl blue-100",w:"full","box-border":"",p:"y-10 x-15",grid:"~ sm:cols-1 md:cols-2 lg:cols-3 xl:cols-4 2xl:cols-5 gap-8"},ae=["onClick","onContextmenu"],se={shadow:"sm blue-100","w-full":"",rounded:"","overflow-hidden":""},ue={bg:"gray-400/20","h-40":"","text-lg":"",p:"x-3 y-1"},ie={p:"x-3 y-2",truncate:""},re=["onClick"],pe=G({async setup(de){let m,B;const V=J(),i=s(),l=E("setLoading"),L=E("loading"),g=s(!1),h=s(!1),p=s(!1),c=s(""),x=s(!1),k=s(""),F=s("");document.title="\u591C\u534A\u5C0F\u8BF4\u7F51";try{l(!0),i.value=([m,B]=K(()=>f.getAllBook()),m=await m,B(),m).result.books,l(!1)}catch(e){l(!1),alert(e)}const M=()=>{g.value=!0},I=()=>{h.value=!0},A=()=>{p.value=!0},S=e=>{var t;(t=i.value)==null||t.push(e)},U=e=>{var a;const t=(a=i.value)==null?void 0:a.findIndex(u=>u.id===e.id);i.value[t].name=e.name},N=e=>{var a,u;const t=(a=i.value)==null?void 0:a.findIndex(o=>o.id===e);t>=0&&((u=i.value)==null||u.splice(t,1))},j=async e=>{try{l(!0),e=b(e),await f.updateBookName({id:c.value,name:e}),U({id:c.value,name:e}),l(!1)}catch(t){l(!1),alert(t)}},z=async e=>{try{l(!0),e=b(e);const t=(await f.create({name:e})).result.id;S({id:t,name:e}),l(!1)}catch(t){l(!1),alert(t)}},$=(e,t)=>{x.value=!0;let{scrollX:a,scrollY:u}=T();k.value=e.clientY+u+"px",F.value=e.clientX+a+"px",c.value=t},v=e=>{e.preventDefault(),x.value=!1},X=async()=>{p.value=!1;try{l(!0),await f.deleteBook({id:c.value}),N(c.value),l(!1)}catch(e){l(!1),alert(e)}},Y=e=>{V.push({name:"edit",params:{name:e.name,id:e.id}})},q=s([{name:"\u4FEE\u6539\u540D\u5B57",clickMe:I},{name:"\u5220\u9664\u672C\u4E66",clickMe:A}]);return O(()=>{window.addEventListener("click",v),window.addEventListener("contextmenu",v)}),P(()=>{window.removeEventListener("click",v),window.removeEventListener("contextmenu",v)}),(e,t)=>{const a=H,u=R;return r(),d(_,null,[n("div",{"py-10":"","mx-10":"","md:m-x-60":"",class:Q(W(L)?"blur-sm":"")},[n("div",{flex:"",justify:"between","px-3":""},[oe,n("div",{flex:"~ gap-5"},[le,n("div",{"btn-logo":"","i-ph:plus":"",onClick:M})])]),n("div",ne,[(r(!0),d(_,null,D(i.value,o=>(r(),d("div",null,[n("div",{border:"1 gray-300","rounded-md":"","p-2":"",flex:"",justify:"center","items-center":"","cursor-pointer":"",hover:"transition-300 shadow-light-500 shadow-xl -translate-y-1",onClick:C=>Y(o),onContextmenu:te(C=>$(C,o.id),["prevent","stop"])},[n("div",se,[n("div",ue,y(o.name),1)])],40,ae),n("p",ie,y(o.name),1)]))),256))]),w(a,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=o=>g.value=o),onClickEnter:z,title:"\u65B0\u5EFA\u5C0F\u8BF4",placeholder:"\u8BF7\u8F93\u5165\u65B0\u5C0F\u8BF4\u540D"},null,8,["modelValue"])],2),x.value?(r(),d("div",{key:0,p:"y-1 ","w-25":"",border:"1 gray-400",shadow:"sm gray-900/10","rounded-md":"",absolute:"","z-10":"",bg:"white",style:Z({top:k.value,left:F.value})},[(r(!0),d(_,null,D(q.value,o=>(r(),d("div",{"font-mono":"",text:"sm center gray-900","p-y-1":"","p-x-3":"","hover-bg":"blue-500/20",onClick:o.clickMe,"select-none":"","cursor-pointer":""},y(o.name),9,re))),256))],4)):ee("",!0),w(a,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=o=>h.value=o),onClickEnter:j,title:"\u4FEE\u6539\u5C0F\u8BF4\u540D",placeholder:"\u8BF7\u8F93\u5165\u5C0F\u8BF4\u540D"},null,8,["modelValue"]),w(u,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=o=>p.value=o),tips:"\u662F\u5426\u5220\u9664\u672C\u4E66\uFF1F",onClickEnter:X},null,8,["modelValue"])],64)}}});export{pe as default};
