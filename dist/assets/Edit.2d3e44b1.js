import{c as O,d as se,r as ee,t as ue,_ as ie,b as ce,g as F,a as de}from"./Dialog.21d933c9.js";import{d as j,i as U,o as x,c as I,a as c,u as D,h as z,b as me,r as i,e as pe,f as ve,w as K,v as Q,g as he,t as B,n as q,j as te,k as fe,l as X,m as L,p as G,q as ne,F as ae,s as le,x as R,T as H,y as J,z as ge,A as xe,B as Y,C as Z}from"./index.88a4e0a2.js";const Ce=c("div",{border:"1 blue-100",rounded:"1/2","p-6":""},[c("div",{"btn-logo":"","i-ph:plus":"",text:"gray-400"})],-1),_e=c("span",{text:"gray-600"},"\u65B0\u5EFA\u7AE0\u8282",-1),be=[Ce,_e],we=j({setup(e){const o=U("openNewChapterDialog");return(d,t)=>(x(),I("article",null,[c("div",{"rounded-3xl":"",bg:"white",h:"[80vh]",w:"4/5","m-auto":"",flex:"~ col gap-4","justify-center":"","items-center":"","cursor-pointer":"",onClick:t[0]||(t[0]=(...r)=>D(o)&&D(o)(...r))},be)]))}});function ye(e){return z.request({url:"newChapter",method:"post",data:e})}function ke(e){return z.request({url:`getChapterContent?id=${e.id}`})}function Ie(e){return z.request({url:"updateChapterName",method:"post",data:e})}function Ee(e){return z.request({url:"updateChapterContent",method:"post",data:e})}function Te(e){return z.request({url:"deletechapter",method:"post",data:e})}var S={create:ye,getChapterContent:ke,updateChapterName:Ie,updateChapterContent:Ee,deleteChapter:Te};const oe=me("main",{state:()=>({article:{id:"",title:"",content:""}}),getters:{id:e=>e.article.id,title:e=>e.article.title,content:e=>e.article.content,contentWordsCount:e=>O(e.article.content)},actions:{setTitle(e){this.article.title=e},setContent(e){this.article.content=e},updateChapter(e,o,d){this.article.id=e,this.article.title=o,this.article.content=d}}}),Ne={"md:mt-10":"","mt-4":"","min-h":"4/5",bg:"white","whitespace-pre-wrap":"","rounded-3xl":"",p:"x-3 md:x-10 y-6",relative:"",font:"sans"},De={p:"y-2 x-2",text:"sm gray-400",flex:"",justify:"between"},Ae={text:"right"},$e=["contenteditable"],Se=j({emits:["updateTitle"],setup(e,{expose:o,emit:d}){const t=oe(),r=i(t.title),E=i(" "),y=i(!1),k=i(!1),b=i(null),m=i(null),N=i(0),T=()=>{r.value=t.title,y.value=!0},C=()=>{y.value=!1},$=async()=>{k.value=!k.value,k.value||(await p(m.value,!1),V())},_=l=>{l.preventDefault();let w="",g=null;w=l.clipboardData.getData("text/plain"),g=window.getSelection().getRangeAt(0),g.deleteContents();let n=document.createTextNode(w);g.insertNode(n),g.collapse(!1),h(l.target,!0),A()};async function p(l,w){try{let g=l.innerText;await S.updateChapterContent({id:t.id,content:g}),t.setContent(g);let n=new Date;E.value=`\u6587\u7AE0${w?"\u81EA\u52A8":""}\u4FDD\u5B58\u4E8E${n.toLocaleTimeString()}`}catch(g){alert(g)}}async function s(l){try{l=l||" ",t.setTitle(l),d("updateTitle",t.id,l),await S.updateChapterName({id:t.id,title:l})}catch(w){alert(w)}}const A=async()=>{var l;await te(),N.value=O((l=m.value)==null?void 0:l.innerText)},{fnDebounced:h,clearTime:V}=se(p,5e3),P=l=>{y.value&&l.target!=b.value&&(C(),r.value=ee(r.value),s(r.value),l.stopPropagation())};return o({changeContentWordsCount:A,contentEditor:m}),pe(()=>{var l;window.addEventListener("click",P,!0),N.value=O((l=m.value)==null?void 0:l.innerText)}),ve(()=>{window.removeEventListener("click",P)}),(l,w)=>(x(),I("article",null,[c("div",{"w-full":"",onDblclick:T,text:"lg center","font-bold":""},[K(c("input",{w:"full",type:"text","onUpdate:modelValue":w[0]||(w[0]=g=>r.value=g),border:"0 gray-500 b-2",outline:"none",bg:"transparent",text:"lg center",font:"bold sans",ref_key:"titleInput",ref:b},null,512),[[Q,y.value],[he,r.value]]),K(c("div",{"font-sans":"",border:"0 b-2 transparent","whitespace-pre-wrap":""},B(D(t).title?D(t).title:" "),513),[[Q,!y.value]])],32),c("div",Ne,[c("div",{class:q(k.value?"i-mdi:content-save":"i-mdi:pen"),absolute:"","top-3":"","right-5":"","btn-logo":"",text:"gray-600",onClick:$},null,2),c("div",De,[c("span",null,"\u672C\u7AE0\u5B57\u6570\uFF1A"+B(N.value),1),c("span",Ae,B(E.value),1)]),c("div",{"min-h":"[68vh]","w-full":"","inline-block":"","outline-none":"",contenteditable:k.value,text:"base",ref_key:"contentEditor",ref:m,onInput:w[1]||(w[1]=g=>{D(h)(g.target,!0),A()}),onPaste:_},B(D(t).content),41,$e)])]))}});var re=(e,o)=>{const d=e.__vccOpts||e;for(const[t,r]of o)d[t]=r;return d};const Me=["onClick"],Fe=["onClick"],Be=j({props:{name:null,logo:null,menuItems:null,duration:{default:.5},menuScrollIndex:null},emits:["clickMe"],setup(e,{emit:o}){const d=e,t=i(null),r=i(!1),E=i(""),y=U("openNewChapterDialog"),k=U("deleteCatalogItem"),b=p=>{r.value=!0,E.value=p},m=i(!1),N=ue(()=>{d.menuItems&&(m.value=!m.value)},d.duration*1e3),T=p=>p.selected?"bg-blue-100/50 hover:bg-blue-100/50":"hover:bg-blue-100/20",C=p=>{var s;(s=d.menuItems)==null||s.forEach(A=>A.selected=!1),p.selected=!0},$=async p=>{r.value=!1;try{await S.deleteChapter({id:p}),k&&await k(p)}catch(s){alert(s)}},_=p=>{te().then(function(){var s;(s=t.value)==null||s.scrollTo(0,p<=2?0:(p-2)*32.7)})};return fe(()=>d.menuScrollIndex,p=>{_(p)}),(p,s)=>{const A=ie;return x(),I("div",null,[c("div",{"menu-item":"",onClick:s[0]||(s[0]=h=>{D(N)(),o("clickMe")}),class:q({"bg-blue-200/400":m.value,"hover:bg-blue-200/400":m.value}),"mb-1":""},[c("div",{class:q(e.logo),text:"base"},null,2),X(" "+B(e.name),1)],2),L(H,{appear:"",name:"itemList"},{default:G(()=>[m.value?(x(),I("div",{key:0,style:ne({"transition-duration":e.duration+"s"}),"max-h":"[35vh]",shadow:"sm gray-200","rounded-lg":"","box-border":"","overflow-y-auto":"",class:"hideScrollbar",ref_key:"menu",ref:t},[c("div",{p:"l-4 r-2 y-2",text:"xs center",cursor:"pointer","border-gray-100":"",border:"0 b-1",onClick:s[1]||(s[1]=(...h)=>D(y)&&D(y)(...h)),bg:"red-100/40 hover:red-100/70 active:red-100"}," \u65B0\u5EFA\u7AE0\u8282 "),(x(!0),I(ae,null,le(e.menuItems,h=>(x(),I("div",{p:"l-4 r-2 y-2",text:"xs",cursor:"pointer","border-gray-100":"",border:"0 b-1",truncate:"",relative:"",key:h.id,onClick:V=>{h.clickMe(),C(h)},class:q([T(h),"item"])},[X(B(h.itemName)+" ",1),h.canDelete?(x(),I("div",{key:0,class:"delete",hidden:"","btn-logo":"","i-mdi:trash-can-outline":"",absolute:"",right:"1",top:"1/2","translate-y":"-1/2",onClick:V=>b(h.id)},null,8,Fe)):R("",!0)],10,Me))),128))],4)):R("",!0)]),_:1}),L(A,{modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=h=>r.value=h),tips:"\u662F\u5426\u5220\u9664\u8BE5\u7AE0\u8282\uFF1F",onClickEnter:s[3]||(s[3]=h=>$(E.value))},null,8,["modelValue"])])}}});var Le=re(Be,[["__scopeId","data-v-15a42f3e"]]);const Ve={key:0,"w-65":"","h-screen":"","rounded-r-3xl":"","bg-white":"",fixed:"","z-10":"",flex:"~ col gap-8","items-center":""},We={"m-y-25":"",h:"[70vh]","w-53":"",font:"sans semibold",text:"sm gray-600",flex:"~ col gap-3","select-none":""},qe={key:0,h:"20",shadow:"lg blue-500/50","bg-white":"","rounded-r-xl":"",top:"[40vh]",flex:"",justify:"center","items-center":"",fixed:""},Ue=j({props:{novelId:null,menuList:null,menuScrollIndex:null},emits:["expand","close"],setup(e,{emit:o}){const d=i(null),t=i(!1),r=()=>{t.value=!0,o("expand")},E=()=>{t.value=!1,o("close")};return(y,k)=>(x(),I("aside",null,[L(H,{name:"menu"},{default:G(()=>[t.value?(x(),I("div",Ve,[c("div",We,[(x(!0),I(ae,null,le(e.menuList,(b,m)=>(x(),J(Le,{key:m,name:b.name,logo:b.logo,menuScrollIndex:e.menuScrollIndex,"menu-items":b.menuItems,duration:b.duration,onClickMe:N=>b.clickMe?b.clickMe():null,ref_for:!0,ref_key:"menuModal",ref:d},null,8,["name","logo","menuScrollIndex","menu-items","duration","onClickMe"]))),128))]),c("div",{"i-mdi:close":"","btn-logo":"",absolute:"","top-3":"","right-3":"",text:"gray-600",onClick:E})])):R("",!0)]),_:1}),L(H,{name:"expand"},{default:G(()=>[t.value?R("",!0):(x(),I("div",qe,[c("div",{btn:"","i-mdi:menu":"","px-2":"",onClick:r})]))]),_:1})]))}});var je=re(Ue,[["__scopeId","data-v-0ca8fd82"]]);const Re=j({async setup(e){let o,d;const t=i(null),r=i(0),E=i("0"),y=ge(),k=xe(),b=i(y.params.name),m=oe(),N=i(y.params.id),T=i(),C=i(),$=i(!1);document.title=b.value;const _=U("setLoading"),p=U("loading"),s=(n,v,a)=>({id:n,itemName:v,selected:a,canDelete:!0,clickMe:async function(){var f;if(!this.selected){_(!0);try{let u=(await S.getChapterContent({id:this.id})).result.content;m.updateChapter(this.id,this.itemName,u),window.scrollTo(0,0),await((f=t.value)==null?void 0:f.changeContentWordsCount())}catch(u){alert(u)}_(!1)}}});try{if(_(!0),T.value=([o,d]=Y(()=>ce.getChapters({id:N.value})),o=await o,d(),o).result.chapters,T.value.sort((n,v)=>F(n.title)-F(v.title)),T.value.length>0){let n=([o,d]=Y(()=>S.getChapterContent({id:T.value[0].id})),o=await o,d(),o).result.content;m.updateChapter(T.value[0].id,T.value[0].title,n)}_(!1),C.value=[{name:"\u4E3B\u9875",logo:"i-ph:house",clickMe:()=>{k.push("/home")}},{name:"\u76EE\u5F55",logo:"i-mdi:format-align-right",menuItems:T.value.map((n,v)=>s(n.id,n.title,v===0))},{name:"\u8BBE\u7F6E",logo:"i-ph:nut-bold"},{name:"\u5173\u4E8E",logo:"i-mdi:information-outline"}]}catch(n){_(!1),alert(n),k.push("/home")}const A=(n,v)=>{if(C.value){const a=C.value[1].menuItems;if(a){let f=a.findIndex(u=>u.id===n);a[f].itemName=v,a.sort((u,M)=>F(u.itemName)-F(M.itemName)),f=a.findIndex(u=>u.id===n),r.value=f}}},h=(n,v)=>{if(C.value){const a=C.value[1].menuItems;if(a){let f=a.findIndex(u=>F(u.itemName)>F(v));f===-1&&(f=a.length),a.forEach(u=>u.selected=!1),a.splice(f,0,s(n,v,!0)),r.value=f}}},V=()=>{$.value=!0},P=async n=>{var v;if(C.value){const a=C.value[1].menuItems;if(a){let f=a.findIndex(W=>W.id===n);if(a.splice(f,1),a.length===0){m.updateChapter("","","");return}else f===a.length&&f--;const u=a[f];_(!0);let M=(await S.getChapterContent({id:u.id})).result.content;_(!1),a.forEach(W=>W.selected=!1),u.selected=!0,m.updateChapter(u.id,u.itemName,M),window.scrollTo(0,0),await((v=t.value)==null?void 0:v.changeContentWordsCount())}}},l=async n=>{var v;try{_(!0),n=ee(n);const a=(await S.create({bookId:N.value,chapterName:n})).result.id;_(!1),h(a,n),m.updateChapter(a,n,""),window.scrollTo(0,0),await((v=t.value)==null?void 0:v.changeContentWordsCount())}catch(a){_(!1),alert(a)}};Z("openNewChapterDialog",V),Z("deleteCatalogItem",P);const w=()=>{E.value=16.25+"rem"},g=()=>{E.value="0"};return(n,v)=>{var u,M;const a=we,f=de;return x(),I("div",{bg:"light-600","min-h":"full",flex:"",class:q(D(p)?"blur-sm":"")},[L(je,{onExpand:w,onClose:g,novelId:N.value,menuList:C.value,menuScrollIndex:r.value,"z-10":""},null,8,["novelId","menuList","menuScrollIndex"]),c("div",{style:ne({width:E.value}),"min-h":"full","duration-500":"","ease-in-out":""},null,4),C.value&&((M=(u=C.value[1])==null?void 0:u.menuItems)==null?void 0:M.length)?(x(),J(Se,{key:0,"md:my-8":"","md:mx-16":"","my-4":"","mx-1":"",flex:"1",ref_key:"modal",ref:t,onUpdateTitle:A},null,512)):(x(),J(a,{key:1,my:"[10vh]","mx-16":"",flex:"1"})),L(f,{modelValue:$.value,"onUpdate:modelValue":v[0]||(v[0]=W=>$.value=W),onClickEnter:l,title:"\u65B0\u5EFA\u7AE0\u8282",placeholder:"\u8BF7\u8F93\u5165\u65B0\u7AE0\u8282\u540D"},null,8,["modelValue"])],2)}}});export{Re as default};
