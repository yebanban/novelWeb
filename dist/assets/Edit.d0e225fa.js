import{c as H,d as de,r as le,t as ce,_ as me,b as pe,g as B,a as ve}from"./Dialog.0f28402a.js";import{d as U,i as q,o as C,c as E,a as m,u as D,h as j,b as he,r as s,e as fe,f as ge,w as Z,v as ee,g as Ce,t as L,n as W,j as G,k as xe,l as te,m as V,p as J,q as oe,F as ue,s as re,x as P,T as K,y as Q,z as _e,A as be,B as ne,C as ae}from"./index.0d206e09.js";const we=m("div",{border:"1 blue-100",rounded:"1/2","p-6":""},[m("div",{"btn-logo":"","i-ph:plus":"",text:"gray-400"})],-1),ye=m("span",{text:"gray-600"},"\u65B0\u5EFA\u7AE0\u8282",-1),Ie=[we,ye],ke=U({setup(t){const r=q("openNewChapterDialog");return(p,n)=>(C(),E("article",null,[m("div",{"rounded-3xl":"",bg:"white",h:"[80vh]",w:"4/5","m-auto":"",flex:"~ col gap-4","justify-center":"","items-center":"","cursor-pointer":"",onClick:n[0]||(n[0]=(...i)=>D(r)&&D(r)(...i))},Ie)]))}});function Ee(t){return j.request({url:"newChapter",method:"post",data:t})}function Te(t){return j.request({url:`getChapterContent?id=${t.id}`})}function Ne(t){return j.request({url:"updateChapterName",method:"post",data:t})}function De(t){return j.request({url:"updateChapterContent",method:"post",data:t})}function Ae(t){return j.request({url:"deletechapter",method:"post",data:t})}var S={create:Ee,getChapterContent:Te,updateChapterName:Ne,updateChapterContent:De,deleteChapter:Ae};const se=he("main",{state:()=>({article:{id:"",title:"",content:""}}),getters:{id:t=>t.article.id,title:t=>t.article.title,content:t=>t.article.content,contentWordsCount:t=>H(t.article.content)},actions:{setTitle(t){this.article.title=t},setContent(t){this.article.content=t},updateChapter(t,r,p){this.article.id=t,this.article.title=r,this.article.content=p}}}),$e={"md:mt-10":"","mt-4":"","min-h":"4/5",bg:"white","whitespace-pre-wrap":"","rounded-3xl":"",p:"x-3 md:x-10 y-6",relative:"",font:"sans"},Se={p:"y-2 x-2",text:"sm gray-400",flex:"",justify:"between"},Me={text:"right"},Fe=["contenteditable"],Be=U({emits:["updateTitle"],setup(t,{expose:r,emit:p}){const n=se(),i=s(n.title),T=s(" "),I=s(!1),k=s(!1),w=s(null),v=s(null),N=s("");N.value=n.content;const y=s(0),x=()=>{i.value=n.title,I.value=!0},A=()=>{I.value=!1},g=async()=>{k.value=!k.value,k.value||(await l(v.value,!1),R())},h=a=>{a.preventDefault();let _="",e=null;_=a.clipboardData.getData("text/plain"),e=window.getSelection().getRangeAt(0),e.deleteContents();let o=document.createTextNode(_);e.insertNode(o),e.collapse(!1),M(a.target,!0),f()};async function l(a,_){try{let e=a.innerText;await S.updateChapterContent({id:n.id,content:e}),n.setContent(e);let o=new Date;T.value=`\u6587\u7AE0${_?"\u81EA\u52A8":""}\u4FDD\u5B58\u4E8E${o.toLocaleTimeString()}`}catch(e){alert(e)}}async function $(a){try{a=a||" ",n.setTitle(a),p("updateTitle",n.id,a),await S.updateChapterName({id:n.id,title:a})}catch(_){alert(_)}}const f=async()=>{var a;await G(),y.value=H((a=v.value)==null?void 0:a.innerText)},{fnDebounced:M,clearTime:R}=de(l,2e3),z=a=>{I.value&&a.target!=w.value&&(A(),i.value=le(i.value),$(i.value),a.stopPropagation())};return r({changeContentWordsCount:f,contentEditor:v,updateContentEditor:a=>{N.value=a,v.value.innerHTML=a,f()}}),fe(()=>{var a;window.addEventListener("click",z,!0),y.value=H((a=v.value)==null?void 0:a.innerText)}),ge(()=>{window.removeEventListener("click",z)}),(a,_)=>(C(),E("article",null,[m("div",{"w-full":"",onDblclick:x,text:"lg center","font-bold":""},[Z(m("input",{w:"full",type:"text","onUpdate:modelValue":_[0]||(_[0]=e=>i.value=e),border:"0 gray-500 b-2",outline:"none",bg:"transparent",text:"lg center",font:"bold sans",ref_key:"titleInput",ref:w},null,512),[[ee,I.value],[Ce,i.value]]),Z(m("div",{"font-sans":"",border:"0 b-2 transparent","whitespace-pre-wrap":""},L(D(n).title?D(n).title:" "),513),[[ee,!I.value]])],32),m("div",$e,[m("div",{class:W(k.value?"i-mdi:content-save":"i-mdi:pen"),absolute:"","top-3":"","right-5":"","btn-logo":"",text:"gray-600",onClick:g},null,2),m("div",Se,[m("span",null,"\u672C\u7AE0\u5B57\u6570\uFF1A"+L(y.value),1),m("span",Me,L(T.value),1)]),m("div",{"min-h":"[68vh]","w-full":"","inline-block":"","outline-none":"",contenteditable:k.value,text:"base",ref_key:"contentEditor",ref:v,onInput:_[1]||(_[1]=e=>{D(M)(e.target,!0),f()}),onPaste:h},L(N.value),41,Fe)])]))}});var ie=(t,r)=>{const p=t.__vccOpts||t;for(const[n,i]of r)p[n]=i;return p};const Le=["onClick"],Ve=["onClick"],We=U({props:{name:null,logo:null,menuItems:null,duration:{default:.5},menuScrollIndex:null},emits:["clickMe"],setup(t,{emit:r}){const p=t,n=s(null),i=s(!1),T=s(""),I=q("openNewChapterDialog"),k=q("deleteCatalogItem"),w=h=>{i.value=!0,T.value=h},v=s(!1),N=ce(()=>{p.menuItems&&(v.value=!v.value,G().then(()=>{const h=p.menuItems.findIndex(l=>l.selected===!0);g(h)}))},p.duration*1e3),y=h=>h.selected?"bg-blue-100/50 hover:bg-blue-100/50":"hover:bg-blue-100/20",x=h=>{var l;(l=p.menuItems)==null||l.forEach($=>$.selected=!1),h.selected=!0},A=async h=>{i.value=!1;try{await S.deleteChapter({id:h}),k&&await k(h)}catch(l){alert(l)}},g=h=>{G().then(function(){var l;(l=n.value)==null||l.scrollTo(0,h<=3?0:(h-3)*32.7)})};return xe(()=>p.menuScrollIndex,h=>{g(h)}),(h,l)=>{const $=me;return C(),E("div",null,[m("div",{"menu-item":"",onClick:l[0]||(l[0]=f=>{D(N)(),r("clickMe")}),class:W({"bg-blue-200/400":v.value,"hover:bg-blue-200/400":v.value}),"mb-1":""},[m("div",{class:W(t.logo),text:"base"},null,2),te(" "+L(t.name),1)],2),V(K,{appear:"",name:"itemList"},{default:J(()=>[v.value?(C(),E("div",{key:0,style:oe({"transition-duration":t.duration+"s"}),"max-h":"[38vh]",shadow:"sm gray-200","rounded-lg":"","box-border":"","overflow-hidden":""},[m("div",{p:"l-4 r-2 y-2",text:"xs center",cursor:"pointer","border-gray-100":"",border:"0 b-1",onClick:l[1]||(l[1]=(...f)=>D(I)&&D(I)(...f)),bg:"red-100/40 hover:red-100/70 active:red-100"}," \u65B0\u5EFA\u7AE0\u8282 "),m("div",{"max-h":"[33vh]","overflow-y-auto":"",class:"hideScrollbar",ref_key:"menu",ref:n},[(C(!0),E(ue,null,re(t.menuItems,f=>(C(),E("div",{p:"l-4 r-2 y-2",text:"xs",cursor:"pointer","border-gray-100":"",border:"0 b-1",truncate:"",relative:"",key:f.id,onClick:M=>{f.clickMe(),x(f)},class:W([y(f),"item"])},[te(L(f.itemName)+" ",1),f.canDelete?(C(),E("div",{key:0,class:"delete",hidden:"","btn-logo":"","i-mdi:trash-can-outline":"",absolute:"",right:"1",top:"1/2","translate-y":"-1/2",onClick:M=>w(f.id)},null,8,Ve)):P("",!0)],10,Le))),128))],512)],4)):P("",!0)]),_:1}),V($,{modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=f=>i.value=f),tips:"\u662F\u5426\u5220\u9664\u8BE5\u7AE0\u8282\uFF1F",onClickEnter:l[3]||(l[3]=f=>A(T.value))},null,8,["modelValue"])])}}});var qe=ie(We,[["__scopeId","data-v-586428e5"]]);const Ue={key:0,"w-65":"","h-screen":"","rounded-r-3xl":"","bg-white":"",fixed:"","z-10":"",flex:"~ col gap-8","items-center":""},je={"m-y-25":"",h:"[70vh]","w-53":"",font:"sans semibold",text:"sm gray-600",flex:"~ col gap-3","select-none":""},ze={key:0,h:"20",shadow:"lg blue-500/50","bg-white":"","rounded-r-xl":"",top:"[40vh]",flex:"",justify:"center","items-center":"",fixed:""},Pe=U({props:{novelId:null,menuList:null,menuScrollIndex:null},emits:["expand","close"],setup(t,{emit:r}){const p=s(null),n=s(!1),i=()=>{n.value=!0,r("expand")},T=()=>{n.value=!1,r("close")};return(I,k)=>(C(),E("aside",null,[V(K,{name:"menu"},{default:J(()=>[n.value?(C(),E("div",Ue,[m("div",je,[(C(!0),E(ue,null,re(t.menuList,(w,v)=>(C(),Q(qe,{key:v,name:w.name,logo:w.logo,menuScrollIndex:t.menuScrollIndex,"menu-items":w.menuItems,duration:w.duration,onClickMe:N=>w.clickMe?w.clickMe():null,ref_for:!0,ref_key:"menuModal",ref:p},null,8,["name","logo","menuScrollIndex","menu-items","duration","onClickMe"]))),128))]),m("div",{"i-mdi:close":"","btn-logo":"",absolute:"","top-3":"","right-3":"",text:"gray-600",onClick:T})])):P("",!0)]),_:1}),V(K,{name:"expand"},{default:J(()=>[n.value?P("",!0):(C(),E("div",ze,[m("div",{btn:"","i-mdi:menu":"","px-2":"",onClick:i})]))]),_:1})]))}});var Re=ie(Pe,[["__scopeId","data-v-0ca8fd82"]]);const Ge=U({async setup(t){var _;let r,p;const n=s(null),i=s(0),T=s("0"),I=_e(),k=be(),w=s(I.params.name),v=se(),N=s(I.params.id),y=s(),x=s(),A=s(!1);document.title=w.value;const g=q("setLoading"),h=q("loading"),l=(e,o,d)=>({id:e,itemName:o,selected:d,canDelete:!0,clickMe:async function(){var c,u;if(!this.selected){g(!0);try{let b=(await S.getChapterContent({id:this.id})).result.content;v.updateChapter(this.id,this.itemName,b),(c=n.value)==null||c.updateContentEditor(b),window.scrollTo(0,0),await((u=n.value)==null?void 0:u.changeContentWordsCount())}catch(b){alert(b)}g(!1)}}});try{if(g(!0),y.value=([r,p]=ne(()=>pe.getChapters({id:N.value})),r=await r,p(),r).result.chapters,y.value.sort((e,o)=>B(e.title)-B(o.title)),y.value.length>0){let e=([r,p]=ne(()=>S.getChapterContent({id:y.value[0].id})),r=await r,p(),r).result.content;v.updateChapter(y.value[0].id,y.value[0].title,e),(_=n.value)==null||_.updateContentEditor(e)}g(!1),x.value=[{name:"\u4E3B\u9875",logo:"i-ph:house",clickMe:()=>{k.push("/home")}},{name:"\u76EE\u5F55",logo:"i-mdi:format-align-right",menuItems:y.value.map((e,o)=>l(e.id,e.title,o===0))},{name:"\u8BBE\u7F6E",logo:"i-ph:nut-bold"},{name:"\u5173\u4E8E",logo:"i-mdi:information-outline"}]}catch(e){g(!1),alert(e),k.push("/home")}const $=(e,o)=>{if(x.value){const d=x.value[1].menuItems;if(d){let c=d.findIndex(u=>u.id===e);d[c].itemName=o,d.sort((u,b)=>B(u.itemName)-B(b.itemName)),c=d.findIndex(u=>u.id===e),i.value=c}}},f=(e,o)=>{if(x.value){const d=x.value[1].menuItems;if(d){let c=d.findIndex(u=>B(u.itemName)>B(o));c===-1&&(c=d.length),d.forEach(u=>u.selected=!1),d.splice(c,0,l(e,o,!0)),i.value=c}}},M=()=>{A.value=!0},R=async e=>{var o,d,c;if(x.value){const u=x.value[1].menuItems;if(u){let b=u.findIndex(O=>O.id===e);if(u.splice(b,1),u.length===0){v.updateChapter("","",""),(o=n.value)==null||o.updateContentEditor("");return}else b===u.length&&b--;const F=u[b];g(!0);let Y=(await S.getChapterContent({id:F.id})).result.content;g(!1),u.forEach(O=>O.selected=!1),F.selected=!0,v.updateChapter(F.id,F.itemName,Y),(d=n.value)==null||d.updateContentEditor(Y),window.scrollTo(0,0),await((c=n.value)==null?void 0:c.changeContentWordsCount())}}},z=async e=>{var o,d;try{g(!0),e=le(e);const c=(await S.create({bookId:N.value,chapterName:e})).result.id;g(!1),f(c,e),v.updateChapter(c,e,""),window.scrollTo(0,0),await((o=n.value)==null?void 0:o.changeContentWordsCount()),(d=n.value)==null||d.updateContentEditor("")}catch(c){g(!1),alert(c)}};ae("openNewChapterDialog",M),ae("deleteCatalogItem",R);const X=()=>{T.value=16.25+"rem"},a=()=>{T.value="0"};return(e,o)=>{var u,b;const d=ke,c=ve;return C(),E("div",{bg:"light-600","min-h":"full",flex:"",class:W(D(h)?"blur-sm":"")},[V(Re,{onExpand:X,onClose:a,novelId:N.value,menuList:x.value,menuScrollIndex:i.value,"z-10":""},null,8,["novelId","menuList","menuScrollIndex"]),m("div",{style:oe({width:T.value}),"min-h":"full","duration-500":"","ease-in-out":""},null,4),x.value&&((b=(u=x.value[1])==null?void 0:u.menuItems)==null?void 0:b.length)?(C(),Q(Be,{key:0,"md:my-8":"","md:mx-16":"","my-4":"","mx-1":"",flex:"1",ref_key:"modal",ref:n,onUpdateTitle:$},null,512)):(C(),Q(d,{key:1,my:"[10vh]","mx-16":"",flex:"1"})),V(c,{modelValue:A.value,"onUpdate:modelValue":o[0]||(o[0]=F=>A.value=F),onClickEnter:z,title:"\u65B0\u5EFA\u7AE0\u8282",placeholder:"\u8BF7\u8F93\u5165\u65B0\u7AE0\u8282\u540D"},null,8,["modelValue"])],2)}}});export{Ge as default};
